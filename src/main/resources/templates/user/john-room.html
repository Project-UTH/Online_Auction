<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ph√≤ng ƒê·∫•u Gi√°</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.75rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1100px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1.5rem;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
        }

        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #667eea;
        }

        .auth-buttons {
            display: flex;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-outline {
            border: 2px solid #667eea;
            color: #667eea;
            background: transparent;
        }

        .btn-outline:hover {
            background: #667eea;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.3);
        }

        .user-info {
            color: #333;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .container {
            flex: 1;
            max-width: 1100px;
            margin: 0 auto;
            padding: 40px 16px 20px;
        }

        .title {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            text-align: center;
        }

        .auction-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 1rem;
        }

        .auction-header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .auction-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .auction-meta p {
            font-size: 0.9rem;
            color: #666;
        }

        .auction-meta p strong {
            color: #333;
            font-weight: 600;
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.active {
            background-color: #27ae60;
            color: white;
        }

        .status-badge.pending {
            background-color: #f39c12;
            color: white;
        }

        .status-badge.completed {
            background-color: #95a5a6;
            color: white;
        }

        .auction-ended-banner {
            background: rgba(255, 99, 71, 0.9);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 1rem;
            animation: slideDown 0.5s ease-out;
        }

        .grid {
            display: flex;
            flex-direction: row;
            overflow-x: auto;
            gap: 1rem;
            margin-bottom: 1rem;
            scroll-snap-type: x mandatory;
        }

        .product-item {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            transition: all 0.3s ease;
            flex: 0 0 auto;
            width: 400px;
            scroll-snap-align: start;
        }

        .product-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .product-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
        }

        .product-status {
            font-size: 0.75rem;
        }

        .product-image {
            margin-bottom: 0.75rem;
        }

        .product-image img {
            max-width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
            margin: 0 auto;
            border-radius: 8px;
        }

        .product-info {
            margin-bottom: 0.75rem;
        }

        .description {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .price-info {
            margin-bottom: 0.5rem;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .label {
            font-weight: 600;
            color: #333;
        }

        .current-price-section {
            margin-bottom: 0.75rem;
        }

        .current-price-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 0.75rem;
            text-align: center;
        }

        .current-price {
            font-size: 1.25rem;
            font-weight: 700;
            color: #059669;
            display: block;
            animation: priceUpdate 0.5s ease-in-out;
        }

        .last-bidder {
            font-size: 0.75rem;
            color: #64748b;
            display: block;
        }

        .winner-display {
            padding: 1rem;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            text-align: center;
            border-radius: 8px;
        }

        .trophy-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .winner-card h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .countdown-section {
    text-align: center;
    margin-top: 1rem;
}

.countdown-display {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    font-size: 1.2rem;
    font-weight: 600;
    color: #333;
}

.countdown-display span {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    padding: 0.5rem;
    min-width: 40px;
    text-align: center;
}

        .winner-name, .winning-amount {
            font-size: 0.9rem;
        }

        .bid-section {
            margin-bottom: 0.75rem;
        }

        .bid-interface {
            margin-bottom: 0.5rem;
        }

        .bid-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .input-group {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .bid-input {
            flex: 1;
            padding: 0.5rem;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .input-suffix {
            padding: 0.5rem;
            color: #666;
        }

        .auction-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auction-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.3);
        }

        .bid-button .btn-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #fff;
            border-top: 2px solid #000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 8px;
        }

        .bid-hints {
            font-size: 0.75rem;
            color: #64748b;
        }

        .quick-bid-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.25rem;
        }

        .quick-bid-btn {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
        }

        .quick-bid-btn:hover {
            background: #e5e7eb;
        }

        .inactive-product {
            text-align: center;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .inactive-message {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .inactive-icon {
            font-size: 1.25rem;
        }

        .bid-history {
            margin-bottom: 0.75rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .section-header h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
        }

        .bid-count {
            font-size: 0.75rem;
            color: #64748b;
        }

        .history-container {
            max-height: 150px;
            overflow-y: auto;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 0.5rem;
        }

        .bid-history-list {
            list-style: none;
            font-size: 0.85rem;
        }

        .bid-history-list li {
            padding: 0.25rem 0;
            color: #666;
        }

        .bid-history-list .no-bids {
            color: #64748b;
            text-align: center;
        }

        .product-stats {
            display: flex;
            justify-content: space-between;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .stat-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 0.5rem;
            text-align: center;
            flex: 1;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #64748b;
            display: block;
        }

        .stat-value {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
        }

        .participants-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 1rem;
        }

        .connection-status-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .connection-status.disconnected .status-indicator {
            width: 10px;
            height: 10px;
            background-color: #e53e3e;
            border-radius: 50%;
            display: inline-block;
        }

        .connection-status.connected .status-indicator {
            width: 10px;
            height: 10px;
            background-color: #27ae60;
            border-radius: 50%;
            display: inline-block;
        }

        .status-text {
            font-size: 0.9rem;
            color: #333;
        }

        .section-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .participants-container {
            max-height: 200px;
            overflow-y: auto;
        }

        .participants-list {
            list-style: none;
            font-size: 0.85rem;
            color: #666;
        }

        .participants-list li {
            padding: 0.25rem 0;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes priceUpdate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); background-color: #10b981; color: white; }
            100% { transform: scale(1); }
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .header-content {
                padding: 0 1rem;
            }
            .nav-links {
                display: none;
            }
            .title {
                font-size: 2rem;
            }
            .container {
                padding: 20px 12px;
            }
            .grid {
                flex-direction: row;
            }
            .auction-header, .participants-panel, .connection-status-panel {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">H</div>
            </div>
            <nav class="nav-links">
                <a th:href="@{/}">Trang ch·ªß</a>
                <a th:href="@{/cart}">Gi·ªè h√†ng</a>
                <a th:href="@{/user/auction-room}">Danh s√°ch phi√™n ƒë·∫•u gi√°</a>
                <a th:href="@{/logout}" th:unless="${session.jwtToken == null}">ƒêƒÉng xu·∫•t</a>
            </nav>
            <div class="auth-buttons" th:unless="${session.jwtToken != null}">
                <a th:href="@{/login}" class="btn btn-outline">ƒêƒÉng nh·∫≠p</a>
                <a th:href="@{/register}" class="btn btn-primary">ƒêƒÉng k√Ω</a>
            </div>
            <div th:if="${session.jwtToken != null}" class="user-info">
                <span th:text="'Ch√†o, ' + ${#strings.capitalize(session.displayName ?: session.username)}"></span>
                <div class="user-stats">
                    <span id="userBidCount">0 l∆∞·ª£t ƒë·∫•u gi√°</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Connection Status Panel -->
        <div id="connectionStatus" class="connection-status-panel disconnected">
            <span class="status-indicator"></span>
            <span class="status-text">ƒêang k·∫øt n·ªëi...</span>
        </div>

        <!-- Auction Info Header -->
        <div class="auction-header">
    <h1 class="title" th:text="${auction.name} ?: 'Phi√™n ƒê·∫•u Gi√°'"></h1>
    <div class="auction-meta">
        <p>üìÖ Ng√†y: <span th:text="${#temporals.format(auction.auctionDate, 'dd/MM/yyyy')} ?: 'Ch∆∞a thi·∫øt l·∫≠p'"></span></p>
        <p>‚è∞ Th·ªùi gian: <span th:text="${#temporals.format(auction.startTime, 'HH:mm')} + ' - ' + ${#temporals.format(auction.endTime, 'HH:mm')} ?: 'Ch∆∞a thi·∫øt l·∫≠p'"></span></p>
        <p>üìä Tr·∫°ng th√°i: <span th:class="'status-badge ' + ${#strings.toLowerCase(auction.status)}" th:text="${auction.status} ?: 'Ch∆∞a x√°c ƒë·ªãnh'"></span></p>
    </div>
    <div class="countdown-section">
        <h3>Th·ªùi gian c√≤n l·∫°i</h3>
        <div class="countdown-display">
            <span id="countdown-days">00</span> ng√†y
            <span id="countdown-hours">00</span> gi·ªù
            <span id="countdown-minutes">00</span> ph√∫t
            <span id="countdown-seconds">00</span> gi√¢y
        </div>
    </div>
</div>

        <input type="hidden" id="auctionId" th:value="${auction.id}" />

        <!-- Global Participants Panel -->
        <div class="participants-panel" th:unless="${auction.status.name() == 'COMPLETED'}">
            <div class="section-header">
                <h3>üë• Ng∆∞·ªùi tham gia phi√™n ƒë·∫•u gi√°</h3>
                <span id="participantCount" class="participant-count" th:text="${participants.size()} + ' ng∆∞·ªùi' ?: '0 ng∆∞·ªùi'"></span>
            </div>
        </div>

        <!-- Auction End Notification -->
        <div id="auctionEndedBanner" class="auction-ended-banner" style="display: none;">
            <h2>Phi√™n ƒë·∫•u gi√° ƒë√£ k·∫øt th√∫c!</h2>
            <p>C·∫£m ∆°n b·∫°n ƒë√£ tham gia. K·∫øt qu·∫£ cu·ªëi c√πng ƒë∆∞·ª£c hi·ªÉn th·ªã b√™n d∆∞·ªõi.</p>
        </div>

        <h2>Danh s√°ch s·∫£n ph·∫©m</h2>
        <div class="grid">
            <div th:if="${auction.products.isEmpty()}" class="empty-state">
                <p>üì¶ Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong phi√™n ƒë·∫•u gi√° n√†y.</p>
            </div>
            <div th:each="product : ${auction.products}" class="product-item" th:data-product-id="${product.id}">
                <!-- Product Header -->
                <div class="product-header">
                    <h3 th:text="${product.name} ?: 'Ch∆∞a ƒë·∫∑t t√™n'"></h3>
                    <div class="product-status">
                        <span th:class="'status-badge ' + ${#strings.toLowerCase(product.status)}" 
                              th:text="${product.status}"></span>
                    </div>
                </div>

                <!-- Product Image -->
                <div class="product-image">
                    <img th:src="${product.imageUrl ?: '/images/default-product.png'}" 
                         alt="·∫¢nh s·∫£n ph·∫©m" 
                         loading="lazy" 
                         style="max-width: 100%; height: 200px; object-fit: cover; display: block; margin: 0 auto; border-radius: 8px;" />
                </div>

                <!-- Product Info -->
                <div class="product-info">
                    <p class="description" th:text="${product.description} ?: 'Ch∆∞a c√≥ m√¥ t·∫£'"></p>
                    <div class="price-info">
                        <div class="price-row">
                            <span class="label">Gi√° kh·ªüi ƒëi·ªÉm:</span>
                            <span class="starting-price" th:text="${#numbers.formatInteger(product.startingPrice, 0, 'COMMA')} + 'ƒë'"></span>
                        </div>
                        <div class="price-row">
                            <span class="label">B∆∞·ªõc gi√°:</span>
                            <span class="increment" th:text="${#numbers.formatInteger(product.minimumBidIncrement, 0, 'COMMA')} + 'ƒë'"></span>
                        </div>
                    </div>
                </div>

                <!-- Current Price Display -->
                <div class="current-price-section">
                    <div class="current-price-card">
                        <span class="label">Gi√° hi·ªán t·∫°i</span>
                        <span th:id="'currentPrice_' + ${product.id}" 
                              class="current-price" 
                              th:text="${product.currentPrice != null} ? ${#numbers.formatInteger(product.currentPrice, 0, 'COMMA')} + 'ƒë' : ${#numbers.formatInteger(product.startingPrice, 0, 'COMMA')} + 'ƒë'"
                              th:data-starting-price="${product.startingPrice}"
                              th:data-current-price="${product.currentPrice}">
                        </span>
                        <span th:id="'lastBidder_' + ${product.id}" 
                              class="last-bidder" 
                              th:text="${product.lastBidder != null} ? 'ƒê·∫•u gi√° b·ªüi: ' + ${product.lastBidder} : ''"></span>
                    </div>
                </div>

                <!-- Winner Display (for completed products) -->
                <div th:id="'winnerDisplay_' + ${product.id}" class="winner-display" style="display: none;">
                    <div class="winner-card">
                        <div class="trophy-icon">üèÜ</div>
                        <h4>Ng∆∞·ªùi th·∫Øng cu·ªôc</h4>
                        <p class="winner-name" th:text="${product.winner != null} ? ${product.winner.username} : 'Kh√¥ng c√≥ ng∆∞·ªùi th·∫Øng'"></p>
                        <p class="winning-amount" th:text="${product.currentPrice != null} ? ${#numbers.formatInteger(product.currentPrice, 0, 'COMMA')} + 'ƒë' : '0ƒë'"></p>
                    </div>
                </div>

                <!-- Bid Section -->
                <div class="bid-section">
                    <!-- Active bidding interface -->
                    <div th:if="${auction.status.name() == 'ACTIVE' and product.status.name() == 'ACTIVE'}" 
                         th:id="'bidInterface_' + ${product.id}" class="bid-interface">
                        <div class="bid-controls">
                            <div class="input-group">
                                <input type="number" 
                                       th:id="'bidAmount_' + ${product.id}" 
                                       placeholder="Nh·∫≠p s·ªë ti·ªÅn" 
                                       step="1000" 
                                       th:min="${product.currentPrice != null} ? ${product.currentPrice + product.minimumBidIncrement} : ${product.startingPrice + product.minimumBidIncrement}"
                                       class="bid-input"
                                       th:data-min-bid="${product.currentPrice != null} ? ${product.currentPrice + product.minimumBidIncrement} : ${product.startingPrice + product.minimumBidIncrement}" />
                                <span class="input-suffix">ƒë</span>
                            </div>
                            <button class="auction-btn bid-button" 
                                    th:data-product-id="${product.id}"
                                    th:data-current-price="${product.currentPrice != null} ? ${product.currentPrice} : ${product.startingPrice}"
                                    th:data-min-increment="${product.minimumBidIncrement}">
                                <span class="btn-text">ƒê·∫∑t Gi√°</span>
                                <div class="btn-spinner" style="display: none;"></div>
                            </button>
                        </div>
                        <div class="bid-hints">
                            <p class="bid-hint">
                                üí° Gi√° t·ªëi thi·ªÉu: <span th:text="${product.currentPrice != null} ? ${#numbers.formatInteger(product.currentPrice + product.minimumBidIncrement, 0, 'COMMA')} + 'ƒë' : ${#numbers.formatInteger(product.startingPrice + product.minimumBidIncrement, 0, 'COMMA')} + 'ƒë'"></span>
                            </p>
                            <div class="quick-bid-buttons">
                                <button type="button" class="quick-bid-btn" th:data-product-id="${product.id}" data-increment="1">+1 b∆∞·ªõc</button>
                                <button type="button" class="quick-bid-btn" th:data-product-id="${product.id}" data-increment="2">+2 b∆∞·ªõc</button>
                                <button type="button" class="quick-bid-btn" th:data-product-id="${product.id}" data-increment="5">+5 b∆∞·ªõc</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Inactive state message -->
                    <div th:unless="${auction.status.name() == 'ACTIVE' and product.status.name() == 'ACTIVE'}" 
                         class="inactive-product">
                        <div th:if="${auction.status.name() != 'ACTIVE'}" class="inactive-message">
                            <div class="inactive-icon">‚è∏Ô∏è</div>
                            <p>Phi√™n ƒë·∫•u gi√° ch∆∞a b·∫Øt ƒë·∫ßu ho·∫∑c ƒë√£ k·∫øt th√∫c</p>
                            <small>Tr·∫°ng th√°i: <span th:text="${auction.status}"></span></small>
                        </div>
                        <div th:if="${auction.status.name() == 'ACTIVE' and product.status.name() != 'ACTIVE'}" 
                             class="inactive-message">
                            <div class="inactive-icon">‚èØÔ∏è</div>
                            <p>S·∫£n ph·∫©m ch∆∞a s·∫µn s√†ng ƒë·∫•u gi√°</p>
                            <small>Tr·∫°ng th√°i: <span th:text="${product.status}"></span></small>
                        </div>
                    </div>
                </div>

                <!-- Bid History -->
                <div class="bid-history">
                    <div class="section-header">
                        <h4>üìú L·ªãch s·ª≠ ƒë·∫•u gi√°</h4>
                        <span th:id="'bidCount_' + ${product.id}" 
                              class="bid-count" 
                              th:text="${product.bidCount != null} ? ${product.bidCount} + ' l∆∞·ª£t' : '0 l∆∞·ª£t'"></span>
                    </div>
                    <div class="history-container">
                        <ul th:id="'bidHistory_' + ${product.id}" class="bid-history-list">
                            <th:block th:if="${product.bidHistory == null or product.bidHistory.isEmpty()}">
                                <li class="no-bids">Ch∆∞a c√≥ ai ƒë·∫•u gi√°</li>
                            </th:block>
                            <th:block th:each="bid : ${product.bidHistory}">
                                <li>
                                    <strong th:text="${bid.user.username}"></strong> - 
                                    <span class="bid-amount" th:text="${#numbers.formatInteger(bid.amount, 0, 'COMMA')} + 'ƒë'"></span>
                                    <small th:text="'(' + ${#temporals.format(bid.timestamp, 'HH:mm:ss dd/MM/yyyy')} + ')'"></small>
                                </li>
                            </th:block>
                        </ul>
                    </div>
                </div>

                <!-- Real-time Stats -->
                <div class="product-stats">
                    <div class="stat-item">
                        <span class="stat-label">S·ªë l∆∞·ª£t ƒë·∫•u gi√°</span>
                        <span th:id="'totalBids_' + ${product.id}" 
                              class="stat-value" 
                              th:text="${product.bidCount != null} ? ${product.bidCount} : 0"></span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Ng∆∞·ªùi tham gia</span>
                        <span th:id="'uniqueBidders_' + ${product.id}" 
                              class="stat-value" 
                              th:text="${product.uniqueBidders != null} ? ${product.uniqueBidders} : 0"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer -->


    <!-- Enhanced auction.js with better error handling -->
    <script th:inline="javascript">
        // Global configuration
        window.auctionConfig = {
            auctionId: /*[[${auction.id}]]*/ null,
            auctionStatus: /*[[${auction.status}]]*/ 'PENDING'
        };

        // Set auth data with error handling
        (function() {
            try {
                if (typeof(Storage) !== "undefined") {
                    const serverToken = /*[[${session.jwtToken}]]*/ null;
                    const serverUsername = /*[[${session.username}]]*/ null;
                    
                    if (serverToken && serverToken !== 'null') {
                        localStorage.setItem('jwtToken', serverToken);
                        console.log('JWT token set from server session');
                    }
                    if (serverUsername && serverUsername !== 'null') {
                        localStorage.setItem('username', serverUsername);
                        console.log('Username set from server session:', serverUsername);
                    }
                }
            } catch (error) {
                console.error('Error setting auth data:', error);
            }
        })();

        // Initialize quick bid buttons and input formatters
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing enhanced features...');
            
            // Hide loading overlay after 2 seconds
            setTimeout(() => {
                const overlay = document.getElementById('loadingOverlay');
                if (overlay) overlay.style.display = 'none';
            }, 2000);
            
            // Initialize quick bid buttons with proper error handling
            const quickBidButtons = document.querySelectorAll('.quick-bid-btn');
            console.log('Found quick bid buttons:', quickBidButtons.length);
            
            quickBidButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const productId = this.getAttribute('data-product-id');
                    const increment = parseInt(this.getAttribute('data-increment') || '1');
                    
                    console.log('Quick bid clicked:', {productId, increment});
                    
                    if (!productId) {
                        console.error('No product ID found for quick bid button');
                        return;
                    }
                    
                    const bidInput = document.getElementById('bidAmount_' + productId);
                    const currentPriceElement = document.getElementById('currentPrice_' + productId);
                    
                    if (bidInput && currentPriceElement) {
                        try {
                            const currentPriceText = currentPriceElement.textContent || currentPriceElement.innerText;
                            const currentPrice = parseFloat(currentPriceText.replace(/[^\d]/g, ''));
                            const minBid = parseFloat(bidInput.getAttribute('data-min-bid') || '0');
                            const stepSize = minBid - currentPrice;
                            
                            const suggestedBid = currentPrice + (stepSize * increment);
                            
                            bidInput.value = Math.floor(suggestedBid).toLocaleString('vi-VN');
                            bidInput.focus();
                            
                            console.log('Quick bid set:', {currentPrice, suggestedBid});
                        } catch (error) {
                            console.error('Error calculating quick bid:', error);
                        }
                    } else {
                        console.error('Bid input or price element not found for product:', productId);
                    }
                });
            });
            
            // Initialize input formatters
            const bidInputs = document.querySelectorAll('.bid-input');
            console.log('Found bid inputs:', bidInputs.length);
            
            bidInputs.forEach(input => {
                input.addEventListener('input', function(e) {
                    let value = this.value.replace(/[^\d]/g, '');
                    if (value && value.length > 0) {
                        const numValue = parseInt(value);
                        if (!isNaN(numValue)) {
                            this.value = numValue.toString();
                        }
                    }
                });
                
                input.addEventListener('blur', function(e) {
                    let value = this.value.replace(/[^\d]/g, '');
                    if (value && value.length > 0) {
                        const numValue = parseInt(value);
                        if (!isNaN(numValue)) {
                            this.value = numValue.toLocaleString('vi-VN');
                        }
                    }
                });
                
                input.addEventListener('focus', function(e) {
                    this.value = this.value.replace(/[^\d]/g, '');
                });
            });
            
            console.log('Enhanced features initialized successfully');
        });
    </script>

    <!-- Load auction.js -->
    <script th:src="@{/js/auction.js}"></script>

</body>
</html>